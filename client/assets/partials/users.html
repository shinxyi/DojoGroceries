<script src="assets/js/users.js"></script>
<div id="dialog" class="hidden" title="Alert">
  <h4>Are you sure you want to delete this user?</h4>
  <p><b>Name:</b><span id="deleteUserName"></span> | <b>Email:</b><span id="deleteUserEmail"></span></p>
  <button class="button" id="deleteUser" ng-click="userCtrl.delete(userCtrl.toDelete.id)">Yes</button>
</div>

<div id="dialog2" class="hidden" title="Change Password">
  <p><b>Name:</b><span id="changepwUserName"></span> | <b>Email:</b><span id="changepwUserEmail"></span></p>
  <label>New Password
    <input type="password" ng-model="userCtrl.pwNew" placeholder="please enter a new password">
  </label>
  <label>Confirm Password
    <input type="password" ng-model="userCtrl.pwNew2" placeholder="please enter a new password">
  </label>
  <button id="submitChangePassword" class="success button" ng-click="userCtrl.changeUserPassword();">Change Password</button>
</div>


<h2>All Users</h2>

<div class="callout alert" ng-if="userCtrl.errors3">
  <ul>
    <li ng-repeat="err in userCtrl.errors3">{{err}}</li>
  </ul>
</div>

<div class="callout success" ng-if="userCtrl.success3">
  <ul>
    <li ng-repeat="msg in userCtrl.success3">{{msg}}</li>
  </ul>
</div>


<input type="text" ng-model="userCtrl.filter" placeholder="Search..."/><br />

<table class="center">
  <thead>
    <tr>
      <th width="250">Name</th>
      <th width="400">Email</th>
      <th width="200">Created At</th>
      <th width="250">User Level</th>
      <th width="150">
        Batch Approve Users<br/>
        <a class="button tiny success" ng-click="userCtrl.processBatch();">Process Batch.</a>
      </th>
      <th width="200">
        Change Password
      </th>
    </tr>
  </thead>
  <tbody>
    <tr ng-repeat="user in userCtrl.allUsers | filter:userCtrl.filter | orderBy:'-createdAt' track by $index">
      <td>
        <span ng-if="user._id!=userCtrl.user._id" class="flag"><a id="{{user._id}}" name="deleteUser"><i class="foundicon-remove"></i></a></span>
        <i>{{user.name}}</i>
        <span class="hidden" ng-click="userCtrl.delete(user._id)" name="{{user._id}}"></span>
      </td>
      <td name="email">{{user.email}}</td>
      <td>
        {{user.createdAt | date:'MMM d, y'}}<br/>
        {{user.createdAt | date:'h:mm:ss a'}}
      </td>
      <td ng-if="user.adminLvl>0">
        {{user.adminLvl}} - <span ng-if="user.adminLvl==9"><i class="fi-star"></i> Admin</span> <span ng-if="user.adminLvl==1">User</span> <span ng-if="user.adminLvl==0">Unapproved</span><br/>
        <a name="edit"><sub>Edit</sub></a>

        <form id="{{$index}}" class="hidden" ng-submit="userCtrl.editAdminLvl(user._id, userCtrl.changeToAdminLvl[user._id])">
          <select ng-model="userCtrl.changeToAdminLvl[user._id]">
            <option value=""> Change User Level</option>
            <option value="9"> 9 - Admin </option>
            <option value="1"> 1 - User </option>
            <option value="0"> 0 - Unapproved </option>
          </select>
          <button type="button submit" class="success button">Save</button>
        </form>
      </td>

      <td ng-if="user.adminLvl==0" class=yellow>
        {{user.adminLvl}} - <span ng-if="user.adminLvl==9"><i class="fi-star"></i> Admin</span> <span ng-if="user.adminLvl==1">User</span> <span ng-if="user.adminLvl==0">Unapproved</span><br/>
        <a name="edit"><sub>Edit</sub></a>

        <form id="{{$index}}" class="hidden" ng-submit="userCtrl.editAdminLvl(user._id, userCtrl.changeToAdminLvl[user._id])">
          <select ng-model="userCtrl.changeToAdminLvl[user._id]">
            <option value=""> Change User Level</option>
            <option value="9"> 9 - Admin </option>
            <option value="1"> 1 - User </option>
            <option value="0"> 0 - Unapproved </option>
          </select>
          <button type="button submit" class="success button">Save</button>
        </form>
      </td>
      <td><input type="checkbox" ng-model="userCtrl.batchProcessInfo[user._id]"></td>
      <td>
        <button class="button" type="button" name="changethisPassword" ng-click="userCtrl.setChangePw(user.email)">Change</button>
          <!-- <div class="dropdown-pane" id="{{userCtrl._id}}" data-dropdown>
            this is some text
            <input type="text" ng-model="userCtrl.someInfo" placeholder="change password...">
          </div> -->
      </td>
    </tr>

  </tbody>
</table>

<div class="medium-6 columns float-left">
  <fieldset class="fieldset">
    <legend><span class="warning label">Change a user's password</span></legend>
    <div class="row">
      <div class="medium-5 columns">
        <label>User's email
          <input type="text" ng-model="userCtrl.pwEmail" placeholder="email@domain.com">
        </label>
      </div>

      <div class="medium-5 columns">
        <label>New Password
          <input type="text" ng-model="userCtrl.pwNew" placeholder="please enter a new password">
        </label>
      </div>
    </div>
    <button class="success button" ng-click="userCtrl.changeUserPassword();">Change Password</button>
  </fieldset>
</div>
