<script src="assets/js/dash.js"></script>
<script src="assets/js/db.js"></script>

<div class="top-bar">
  <div class="top-bar-left">
    <ul class="dropdown menu" data-dropdown-menu>
      <li class="menu-text">Dojo Groceries</li>
      <li class="active"><a>Home</a></li>
      <li><a name="database">Database</a></li>
    </ul>
  </div>
  <div class="top-bar-right">
    <ul class="menu">
      <li><a ng-click="userCtrl.logout()">Logout</a></li>
    </ul>
  </div>
</div>

<div class="row">

  <div class="medium-9 columns">
    <h2>Suggested This Week!</h2>
    <input type="text" ng-model="itemCtrl.filter" placeholder="Search..."/><br />

    <div>
      <div class="callout media-object suggested" ng-repeat="item in itemCtrl.items | filter:itemCtrl.filter | orderBy:itemCtrl.popularVote:true track by $index" ng-if="item.voting_list.hasOwnProperty(itemCtrl.thisweek.week)" >
        <div class="vote">
          <span ng-click="userCtrl.vote(item._id)">
            <span ng-if="userCtrl.user.votes.hasOwnProperty(item._id) && userCtrl.user.votes[item._id]>0" class="success badge">{{ item.voting_list[itemCtrl.thisweek.week] }}</span>
            <span ng-if="!userCtrl.user.votes.hasOwnProperty(item._id) || userCtrl.user.votes[item._id]<0" class="warning badge">{{ item.voting_list[itemCtrl.thisweek.week] }}</span>
            vote(s)
          </spn>
        </div>
        <div class="media-object-section">
          <div class="thumbnail">
            <img src="{{ item.img }}" ng-if="item.img"/>
            <img src="/assets/static/images/placeholder.png" ng-if="!item.img"/>
          </div>
        </div>
        <div class="media-object-section">

          <h4><b>{{ item.name }}</b> | {{ item.price | currency }}</h4>
          <div class="indent">
            <h6><b>Category:</b> {{ item.category }}</h6>
            <p>{{ item.description }}</p>
            <div class="callout secondary" ng-repeat="comment in item.comments | orderBy:'createdAt'" ng-if="comment.week==itemCtrl.thisweek.week">
              <b>{{ comment.userName }}</b> says:
              <sup>{{ comment.createdAt | date: 'EEE MM/dd/yy h:mm a'}}</sup>
              <p>{{ comment.content }}</p>
            </div>

            <div class="callout alert" ng-if="commentCtrl.errors">
              <div ng-if="commentCtrl.thisOne===$index">
                <ul>
                  <li ng-repeat="err in commentCtrl.errors">{{err}}</li>
                </ul>
              </div>
            </div>

            <div class="callout warning comment">
              <form ng-submit="commentCtrl.comment(item._id, commentCtrl.msg[item._id], $index);commentCtrl.msg=''">
                <label>
                  Write a Comment!
                  <textarea placeholder="What do you have to say about {{item.name}}?" ng-model="commentCtrl.msg[item._id]"></textarea>
                  <div class="right">
                    <input type="submit" class="button success" value="Send!">
                  </div>
                </label>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="medium-3 columns">
    <h3>Don't see anything you like?</h3>

    <a name="database">Suggest something from the database!</a>
  </div>
</div>
