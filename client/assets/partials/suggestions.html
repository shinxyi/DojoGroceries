<script src="assets/js/dash.js"></script>
<script src="assets/js/db.js"></script>

<div class="row">

  <div class="medium-9 columns">
    <h2>Suggested This Week!</h2>
    <input type="text" ng-model="itemCtrl.filter" placeholder="Search..."/><br />

    <div>
      <div class="callout media-object suggested" ng-repeat="item in itemCtrl.items | filter:itemCtrl.filter | orderBy:itemCtrl.popularVote:true track by $index" ng-if="item.voting_list.hasOwnProperty(itemCtrl.thisweek.week)" >
        <div class="vote" ng-if="userCtrl.user.adminLvl<9">
          <span ng-click="userCtrl.vote(item._id)">
            <span ng-if="userCtrl.user.votes.hasOwnProperty(item._id) && userCtrl.user.votes[item._id]>0" class="success badge">{{ item.voting_list[userCtrl.thisweek.week] }}</span>
            <span ng-if="!userCtrl.user.votes.hasOwnProperty(item._id) || userCtrl.user.votes[item._id]<0" class="warning badge"> <i class="fi-arrow-up"></i> {{ item.voting_list[userCtrl.thisweek.week] }}</span>
            vote(s)
          </span>
        </div>
        <div class="votes" ng-if="userCtrl.user.adminLvl==9">
            <span class="warning badge">{{ item.voting_list[userCtrl.thisweek.week] }}</span>
            vote(s) |
            <a ng-click="itemCtrl.removeFromGroceries(item._id)" ng-if="item.grocery_list[0].week==userCtrl.thisweek.week"><span class="remove"><i class="fi-minus"></i> Remove from Grocery List</span></a>
            <a ng-click="itemCtrl.addToGroceries(item._id)" ng-if="item.grocery_list[0].week!=userCtrl.thisweek.week"> <span class="add"><i class="fi-plus"></i> Add to Grocery List</span></a>
        </div>

        <div class="media-object-section">
          <div class="thumbnail">
            <img src="{{ item.img }}" ng-if="item.img"/>
            <img src="/assets/static/images/placeholder.png" ng-if="!item.img"/>
          </div>
        </div>
        <div class="media-object-section">

          <h4><b>{{ item.name }}</b> | {{ item.price | currency }}</h4>
          <div class="indent">
            <h6><b>Category:</b> {{ item.category }}</h6>
            <p>{{ item.description }}</p>
            <div class="callout secondary" ng-repeat="comment in item.comments | orderBy:'createdAt'" ng-if="comment.week==userCtrl.thisweek.week">
              <b>{{ comment.userName }}</b> says:
              <sup>{{ comment.createdAt | date: 'EEE MM/dd/yy h:mm a'}}</sup>
              <p>{{ comment.content }}</p>
              <div class="right" ng-if="comment.userId!=userCtrl.user._id && comment.active==2">
                <span class="flag"><a ng-click="commentCtrl.flag(comment._id)"><i class="fi-flag"></i> Flag</a></span>
              </div>
              <div class="right" ng-if="comment.userId!=userCtrl.user._id && comment.active==1">
                <span class="flagged"><i class="fi-flag"></i> Flagged</span>
              </div>
              <div class="right" ng-if="comment.userId==userCtrl.user._id">
                <a ng-click="commentCtrl.delete(comment._id)">Delete</a>
              </div>
            </div>

            <div class="callout alert" ng-if="commentCtrl.errors">
              <div ng-if="commentCtrl.thisOne===$index">
                <ul>
                  <li ng-repeat="err in commentCtrl.errors">{{err}}</li>
                </ul>
              </div>
            </div>

            <div class="callout warning comment">
              <form ng-submit="commentCtrl.comment(item._id, commentCtrl.msg[item._id], $index);commentCtrl.msg=''">
                <label>
                  Write a Comment!
                  <textarea placeholder="What do you have to say about {{item.name}}?" ng-model="commentCtrl.msg[item._id]"></textarea>
                  <div class="right">
                    <input type="submit" class="button success" value="Send!">
                  </div>
                </label>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="medium-3 columns">
    <h3>Don't see anything you like?</h3>

    <a name="database">Suggest something from the database!</a>
  </div>
</div>
